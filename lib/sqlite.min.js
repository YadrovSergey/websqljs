!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():e.sqlitejs=n()}(this,function(){function e(e){return"string"==typeof e}function n(e){return"number"==typeof e}function t(e){return"function"==typeof e}function i(e){return"object"==typeof e}function a(e){var n;try{n=JSON.parse(e)}catch(t){n=e}return n}function r(e){var n;return n=new Date(e),70===n.getYear()&&0===n.getMonth()&&1===n.getDate()&&(n=e),n}var o=function(e){this._db=openDatabase(e.name,e.version,e.displayname,e.size)};o.prototype={query:function(e,n){this._db.transaction(function(i){i.executeSql(e,[],function(e,i){t(n)&&n(e,i)},function(e,i){t(n)&&n(e,null,i)})})},createTable:function(e){var n=this,t="CREATE TABLE "+e.name+" (",i=["id INTEGER PRIMARY KEY AUTOINCREMENT","created_at REAL","updated_at REAL"];for(var a in e.fields)if(e.fields.hasOwnProperty(a)){var r=e.fields[a];"json"===r?r="text":"date"===r&&(r="real"),i.push(a+" "+r.toUpperCase())}t+=i.join(", ")+")",this.query(t,function(t,i){e.index.map(function(t){var i=Object.keys(t),a=[],r=t.fields.join("")+" ON "+e.name+" ("+t.fields.join(", ")+")";i.map(function(e){"fields"!==e&&a.push(e)}),r="CREATE "+a.join(" ").toUpperCase()+" INDEX "+r,n.query(r)})})},all:function(i,o){this.query("SELECT * FROM "+i,function(i,u){for(var c=[],f=0;f<u.rows.length;f++){var s=u.rows.item(f);for(var p in s)s.hasOwnProperty(p)&&(e(s[p])?s[p]=a(s[p]):n(s[p])&&(s[p]=r(s[p])));c.push(s)}t(o)&&o(c)})},insert:function(n,a,r){var o=(new Date).getTime(),u=["created_at","updated_at"].concat(Object.keys(a)),c=[o,o];u.map(function(n){var t=a[n];t&&(i(t)&&(t=t instanceof Date?t.getTime():JSON.stringify(t)),e(t)&&(t="'"+t+"'"),c.push(t))});var f="INSERT INTO "+n+" ("+u.join(", ")+") VALUES ("+c.join(", ")+")";this.query(f,function(e,n,i){var a=n?n.insertId:null;t(r)&&r(a,i)})}};var u={_cache:{},openDatabase:function(e){return this._cache[e.name]||(this._cache[e.name]=new o(e)),this._cache[e.name]}};return u});