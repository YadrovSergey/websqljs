!function(n,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.sqlitejs=e()}(this,function(){function n(n){return"string"==typeof n}function e(n){return"number"==typeof n}function t(n){return"function"==typeof n}function i(n){return"object"==typeof n}function r(n){var e;try{e=JSON.parse(n)}catch(t){e=n}return e}function a(n){var e;return e=new Date(n),70===e.getYear()&&0===e.getMonth()&&1===e.getDate()&&(e=n),e}var o=function(n){this._db=openDatabase(n.name,n.version,n.displayname,n.size)};o.prototype={query:function(n,e){this._db.transaction(function(i){i.executeSql(n,[],function(n,i){t(e)&&e(n,i)},function(n,i){t(e)&&e(n,null,i)})})},createTable:function(n){var e=this,t="CREATE TABLE "+n.name+" (",i=["id INTEGER PRIMARY KEY AUTOINCREMENT","created_at REAL","updated_at REAL"];for(var r in n.fields)if(n.fields.hasOwnProperty(r)){var a=n.fields[r];"json"===a?a="text":"date"===a&&(a="real"),i.push(r+" "+a.toUpperCase())}t+=i.join(", ")+")",this.query(t,function(t,i){n.index.map(function(t){var i=Object.keys(t),r=[],a=t.fields.join("")+" ON "+n.name+" ("+t.fields.join(", ")+")";i.map(function(n){"fields"!==n&&r.push(n)}),a="CREATE "+r.join(" ").toUpperCase()+" INDEX "+a,e.query(a)})})},all:function(i,o){this.query("SELECT * FROM "+i,function(i,u){for(var c=[],f=0;f<u.rows.length;f++){var s=u.rows.item(f);for(var p in s)s.hasOwnProperty(p)&&(n(s[p])?s[p]=r(s[p]):e(s[p])&&(s[p]=a(s[p])));c.push(s)}t(o)&&o(c)})},byId:function(n,e,i){var r="SELECT * FROM "+n+" WHERE id="+e;this.query(r,function(n,e,r){var a=e?e.rows[0]:null;t(i)&&i(a,r)})},insert:function(e,r,a){var o=(new Date).getTime(),u=["created_at","updated_at"].concat(Object.keys(r)),c=[o,o];u.map(function(e){var t=r[e];t&&(i(t)&&(t=t instanceof Date?t.getTime():JSON.stringify(t)),n(t)&&(t="'"+t+"'"),c.push(t))});var f="INSERT INTO "+e+" ("+u.join(", ")+") VALUES ("+c.join(", ")+")";this.query(f,function(n,e,i){var r=e?e.insertId:null;t(a)&&a(r,i)})}};var u={_cache:{},openDatabase:function(n){return this._cache[n.name]||(this._cache[n.name]=new o(n)),this._cache[n.name]}};return u});