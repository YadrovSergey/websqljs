!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():e.sqlitejs=n()}(this,function(){function e(e){return"string"==typeof e}function n(e){return"number"==typeof e}function t(e){return"function"==typeof e}function i(e){return Array.isArray(e)}function r(e){var n;try{n=JSON.parse(e)}catch(t){n=e}return n}function a(e){var n;return n=new Date(e),70===n.getYear()&&0===n.getMonth()&&1===n.getDate()&&(n=e),n}var o=function(e){this._db=openDatabase(e.name,e.version,e.displayname,e.size)};o.prototype={query:function(e,n){this._db.transaction(function(i){i.executeSql(e,[],function(e,i){t(n)&&n(e,i)})})},createTable:function(e){var n="CREATE TABLE "+e.name+" (",t=["id INTEGER AUTO_INCREMENT","created_at REAL","updated_at REAL"];for(var i in e.fields)if(e.fields.hasOwnProperty(i)){var r=e.fields[i];"json"===r?r="text":"date"===r&&(r="real"),t.push(i+" "+r.toUpperCase())}n+=t.join(", ")+")",this.query(n,function(n,t){e.index.map(function(n){var t=Object.keys(n),i=[],r=n.fields.join("")+" ON "+e.name+" ("+n.fields.join(", ")+")";t.map(function(e){"fields"!==e&&i.push(e)}),r="CREATE "+i.join(" ")+" INDEX "+r,console.log(r)})})},all:function(i,o){this.query("SELECT * FROM "+i,function(i,f){for(var u=[],c=0;c<f.rows.length;c++){var s=f.rows.item(c);for(var p in s)s.hasOwnProperty(p)&&(e(s[p])?s[p]=r(s[p]):n(s[p])&&(s[p]=a(s[p])));u.push(s)}t(o)&&o(u)})},insert:function(e,n,t){i(n)||(n=[n]);(new Date).getTime()}};var f={_cache:{},openDatabase:function(e){return this._cache[e.name]||(this._cache[e.name]=new o(e)),this._cache[e.name]}};return f});